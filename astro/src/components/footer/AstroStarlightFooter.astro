---
/**
 * Enhanced Custom Starlight Footer Component
 *
 * This component provides a fully customizable, responsive footer for Starlight-based sites.
 * Features include:
 * - Responsive design (mobile, tablet, desktop)
 * - Social media icons with SVG support
 * - Multi-column layout support
 * - Full accessibility (ARIA labels, semantic HTML)
 * - SEO optimization (crawlable content, schema.org markup)
 * - Galaxy theme compatibility
 * - Extensive use of Starlight theme variables
 *
 * IMPORTANT: This is the only file referenced in astro.config.mjs
 * All other files (SocialIcon.astro, typeFooter.ts, etc.) are imports.
 */

import type { FooterConfig } from './typeFooter';
import SocialIcon from './SocialIcon.astro';
import EditLink from 'virtual:starlight/components/EditLink';
import LastUpdated from 'virtual:starlight/components/LastUpdated';
import Pagination from 'virtual:starlight/components/Pagination';

// Static footer configuration - rendered at build time for SEO
const config: FooterConfig = {
  showEditLink: true,
  showLastUpdated: true,
  showPagination: true,
  showStarlightCredit: false,
  showBorder: true,
  showTooltips: true,  // Enable CSS-based tooltips on hover
  useReactFooter: false,  // Set to true to use ReactFooter.tsx for dynamic features
  layout: 'default',
  customLinks: [],
  socialLinks: [
    // Example social links - customize these!
    // { platform: 'github', href: 'https://github.com/KBVE/staryo', tooltip: 'View our code on GitHub' },
    // { platform: 'discord', href: 'https://discord.gg/yourserver', tooltip: 'Join our Discord community' },
    // { platform: 'twitter', href: 'https://twitter.com/youraccount', tooltip: 'Follow us on Twitter' },
  ],
  sections: [],
  copyright: undefined,
  className: '',
};

// For dynamic features, uncomment this and set useReactFooter: true
// import ReactFooter from './ReactFooter';
// {config.useReactFooter ? (
//   <ReactFooter client:only="react" config={config} />
// ) : (
//   <!-- Render static footer below -->
// )}

// Static class names computed at build time
const layoutClass = config.layout ? `layout-${config.layout}` : 'layout-default';
const borderClass = config.showBorder ? 'with-border' : 'no-border';
const showTooltips = config.showTooltips !== false;

// Helper functions for generating consistent labels (static at build time)
const getSocialLabel = (platform: string, customLabel?: string): string => {
  return customLabel || `${platform.charAt(0).toUpperCase() + platform.slice(1)}`;
};

const getSocialAriaLabel = (platform: string, customAriaLabel?: string): string => {
  return customAriaLabel || `Follow us on ${platform.charAt(0).toUpperCase() + platform.slice(1)}`;
};

const getSocialTooltip = (platform: string, customTooltip?: string, customLabel?: string): string => {
  return customTooltip || `Follow us on ${getSocialLabel(platform, customLabel)}`;
};
---

<footer
  class={`sl-flex custom-footer ${layoutClass} ${borderClass} ${config.className || ''}`}
  role="contentinfo"
  aria-label="Site footer"
  itemscope
  itemtype="https://schema.org/WPFooter"
>
  <!-- Meta information section (Edit & Last Updated) -->
  {(config.showEditLink || config.showLastUpdated) && (
    <div class="meta sl-flex" role="group" aria-label="Page metadata">
      {config.showEditLink && <EditLink />}
      {config.showLastUpdated && <LastUpdated />}
    </div>
  )}

  <!-- Pagination controls -->
  {config.showPagination && (
    <div class="pagination-wrapper" role="navigation" aria-label="Page navigation">
      <Pagination />
    </div>
  )}

  <!-- Footer sections (multi-column layout) - Static content for SEO -->
  {config.sections && config.sections.length > 0 && (
    <div class="footer-sections" role="group" aria-label="Footer sections">
      {config.sections.map((section) => (
        <nav
          class="footer-section"
          aria-labelledby={`section-${section.title.toLowerCase().replace(/\s+/g, '-')}`}
          itemscope
          itemtype="https://schema.org/SiteNavigationElement"
        >
          <h3
            class="section-title"
            id={`section-${section.title.toLowerCase().replace(/\s+/g, '-')}`}
            itemprop="name"
          >
            {section.title}
          </h3>
          <ul class="section-links" role="list">
            {section.links.map((link) => (
              <li>
                <a
                  href={link.href}
                  target={link.external ? '_blank' : undefined}
                  rel={link.external ? 'noopener noreferrer nofollow' : undefined}
                  aria-label={link.ariaLabel || link.label}
                  class={`section-link ${showTooltips && link.tooltip ? 'has-tooltip' : ''}`}
                  itemprop="url"
                  data-tooltip={showTooltips && link.tooltip ? link.tooltip : undefined}
                >
                  <span itemprop="name">{link.label}</span>
                  {link.external && (
                    <span class="external-indicator" aria-hidden="true"> â†—</span>
                  )}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      ))}
    </div>
  )}

  <!-- Custom links section - Static content for SEO -->
  {config.customLinks && config.customLinks.length > 0 && (
    <nav
      class="custom-links sl-flex"
      aria-label="Footer navigation links"
      itemscope
      itemtype="https://schema.org/SiteNavigationElement"
    >
      {config.customLinks.map((link) => (
        <a
          href={link.href}
          target={link.external ? '_blank' : undefined}
          rel={link.external ? 'noopener noreferrer nofollow' : undefined}
          aria-label={link.ariaLabel || link.label}
          class={`footer-link ${showTooltips && link.tooltip ? 'has-tooltip' : ''}`}
          itemprop="url"
          data-tooltip={showTooltips && link.tooltip ? link.tooltip : undefined}
        >
          <span itemprop="name">{link.label}</span>
          {link.external && (
            <span class="external-indicator" aria-hidden="true"> â†—</span>
          )}
        </a>
      ))}
    </nav>
  )}

  <!-- Social media links - SEO-friendly with hidden text -->
  {config.socialLinks && config.socialLinks.length > 0 && (
    <nav class="social-links sl-flex" aria-label="Social media links">
      {config.socialLinks.map((social) => (
        <a
          href={social.href}
          target="_blank"
          rel="noopener noreferrer nofollow me"
          aria-label={getSocialAriaLabel(social.platform, social.ariaLabel)}
          class={`social-link ${showTooltips ? 'has-tooltip' : ''}`}
          title={getSocialLabel(social.platform, social.label)}
          itemprop="url"
          data-tooltip={showTooltips ? getSocialTooltip(social.platform, social.tooltip, social.label) : undefined}
        >
          <SocialIcon
            platform={social.platform}
            size={24}
            ariaLabel={getSocialLabel(social.platform, social.label)}
          />
          <!-- SEO-friendly hidden text for crawlers -->
          <span class="visually-hidden" itemprop="name">
            {getSocialLabel(social.platform, social.label)}
          </span>
        </a>
      ))}
    </nav>
  )}

  <!-- Copyright section - Static SEO content -->
  {config.copyright && (
    <div class="copyright" aria-label="Copyright information">
      <p itemprop="copyrightNotice">{config.copyright}</p>
    </div>
  )}

  <!-- Optional Starlight credit -->
  {config.showStarlightCredit && (
    <a
      class="kudos sl-flex"
      href="https://starlight.astro.build"
      target="_blank"
      rel="noopener noreferrer nofollow"
      aria-label="Built with Starlight documentation framework - Opens in new tab"
    >
      <span class="starlight-icon" aria-hidden="true">ðŸŒŸ</span>
      <span>{Astro.locals.t ? Astro.locals.t('builtWithStarlight.label') : 'Built with Starlight'}</span>
    </a>
  )}
</footer>

<style>
  /* ===========================
     STARLIGHT CORE STYLES
     Using Starlight theme variables for consistent theming
     =========================== */

  @layer starlight.core {
    /* Main footer container */
    footer {
      flex-direction: column;
      gap: var(--sl-content-pad-y, 1.5rem);
      padding-block-start: var(--sl-content-pad-y, 2rem);
      width: 100%;
    }

    /* Border styling */
    .with-border {
      border-top: 1px solid var(--sl-color-hairline);
      margin-top: var(--sl-content-pad-y, 3rem);
    }

    .no-border {
      border-top: none;
    }

    /* ===========================
       ACCESSIBILITY - Visually Hidden
       Content visible to screen readers and search engines
       =========================== */

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* ===========================
       CSS-BASED TOOLTIPS
       Pure CSS tooltips using data attributes - no JavaScript required
       =========================== */

    .has-tooltip {
      position: relative;
      cursor: help;
    }

    .has-tooltip::before,
    .has-tooltip::after {
      position: absolute;
      opacity: 0;
      pointer-events: none;
      transition:
        opacity 0.3s var(--sl-ease, ease),
        transform 0.3s var(--sl-ease, ease);
      z-index: 1000;
    }

    /* Tooltip bubble */
    .has-tooltip::before {
      content: attr(data-tooltip);
      background: var(--sl-color-black);
      color: var(--sl-color-white);
      font-size: var(--sl-text-xs);
      line-height: 1.4;
      padding: 0.5rem 0.75rem;
      border-radius: var(--sl-border-radius, 0.375rem);
      white-space: nowrap;
      max-width: 250px;
      text-align: center;
      box-shadow:
        0 4px 6px -1px rgba(0, 0, 0, 0.1),
        0 2px 4px -1px rgba(0, 0, 0, 0.06);
      bottom: calc(100% + 0.5rem);
      left: 50%;
      transform: translateX(-50%) translateY(-4px);
    }

    /* Tooltip arrow */
    .has-tooltip::after {
      content: '';
      border: 5px solid transparent;
      border-top-color: var(--sl-color-black);
      bottom: calc(100% + 0.5rem - 5px);
      left: 50%;
      transform: translateX(-50%) translateY(-4px);
    }

    /* Show tooltip on hover and focus */
    .has-tooltip:hover::before,
    .has-tooltip:hover::after,
    .has-tooltip:focus-visible::before,
    .has-tooltip:focus-visible::after {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Special positioning for social links */
    .social-link.has-tooltip::before {
      bottom: calc(100% + 0.75rem);
      white-space: normal;
      max-width: 200px;
    }

    .social-link.has-tooltip::after {
      bottom: calc(100% + 0.75rem - 5px);
    }

    /* Responsive tooltip adjustments */
    @media (max-width: 48rem) {
      .has-tooltip::before {
        max-width: 180px;
        font-size: 0.75rem;
        padding: 0.4rem 0.6rem;
      }

      /* On mobile, position tooltips above to avoid overflow */
      .section-link.has-tooltip::before,
      .footer-link.has-tooltip::before {
        left: 50%;
        right: auto;
        transform: translateX(-50%) translateY(-4px);
      }
    }

    /* Galaxy theme compatibility */
    @media (prefers-color-scheme: dark) {
      .has-tooltip::before {
        background: rgba(0, 0, 0, 0.95);
        backdrop-filter: blur(8px);
        border: 1px solid var(--sl-color-gray-5);
      }

      .has-tooltip::after {
        border-top-color: rgba(0, 0, 0, 0.95);
      }
    }

    /* Ensure tooltips don't overflow on edges */
    .footer-link.has-tooltip:first-child::before {
      left: 0;
      transform: translateX(0) translateY(-4px);
    }

    .footer-link.has-tooltip:first-child::after {
      left: 1rem;
      transform: translateX(0) translateY(-4px);
    }

    .footer-link.has-tooltip:last-child::before {
      left: auto;
      right: 0;
      transform: translateX(0) translateY(-4px);
    }

    .footer-link.has-tooltip:last-child::after {
      left: auto;
      right: 1rem;
      transform: translateX(0) translateY(-4px);
    }

    /* ===========================
       META SECTION (Edit & Last Updated)
       =========================== */

    .meta {
      gap: var(--sl-nav-gap, 0.75rem) 3rem;
      justify-content: space-between;
      flex-wrap: wrap;
      font-size: var(--sl-text-sm);
      color: var(--sl-color-gray-3);
      line-height: var(--sl-line-height-headings, 1.5);
    }

    .meta > :global(p:only-child) {
      margin-inline-start: auto;
    }

    /* ===========================
       PAGINATION
       =========================== */

    .pagination-wrapper {
      margin-top: var(--sl-nav-gap, 1rem);
    }

    /* ===========================
       FOOTER SECTIONS (Multi-column)
       =========================== */

    .footer-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--sl-content-pad-x, 2rem) var(--sl-content-pad-y, 1.5rem);
      margin: var(--sl-content-pad-y, 2rem) 0;
      padding: var(--sl-content-pad-y, 1.5rem) 0;
    }

    .footer-section {
      display: flex;
      flex-direction: column;
      gap: var(--sl-nav-gap, 1rem);
    }

    .section-title {
      font-size: var(--sl-text-base);
      font-weight: var(--sl-font-weight-semibold, 600);
      color: var(--sl-color-white);
      margin: 0;
      line-height: var(--sl-line-height-headings, 1.5);
    }

    .section-links {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: var(--sl-nav-gap, 0.5rem);
    }

    .section-link {
      font-size: var(--sl-text-sm);
      color: var(--sl-color-gray-3);
      text-decoration: none;
      transition:
        color 0.2s var(--sl-ease, ease),
        transform 0.2s var(--sl-ease, ease);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      line-height: var(--sl-line-height, 1.6);
    }

    .section-link:hover,
    .section-link:focus-visible {
      color: var(--sl-color-white);
      transform: translateX(2px);
    }

    .section-link:focus-visible {
      outline: 2px solid var(--sl-color-accent);
      outline-offset: 2px;
      border-radius: var(--sl-border-radius, 0.25rem);
    }

    /* ===========================
       CUSTOM LINKS
       =========================== */

    .custom-links {
      gap: var(--sl-nav-gap, 1rem) 2rem;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      padding: var(--sl-content-pad-y, 1rem) 0;
    }

    .footer-link {
      font-size: var(--sl-text-sm);
      color: var(--sl-color-gray-3);
      text-decoration: none;
      transition:
        color 0.2s var(--sl-ease, ease),
        transform 0.2s var(--sl-ease, ease);
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      line-height: var(--sl-line-height, 1.6);
      padding: 0.25rem 0.5rem;
      border-radius: var(--sl-border-radius, 0.25rem);
    }

    .footer-link:hover,
    .footer-link:focus-visible {
      color: var(--sl-color-white);
      transform: translateY(-1px);
    }

    .footer-link:focus-visible {
      outline: 2px solid var(--sl-color-accent);
      outline-offset: 2px;
    }

    .external-indicator {
      font-size: 0.875em;
      opacity: 0.7;
      margin-inline-start: 0.125rem;
    }

    /* ===========================
       SOCIAL LINKS
       =========================== */

    .social-links {
      gap: var(--sl-nav-gap, 1rem);
      justify-content: center;
      align-items: center;
      padding: var(--sl-content-pad-y, 1rem) 0;
      flex-wrap: wrap;
    }

    .social-link {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2.5rem;
      height: 2.5rem;
      padding: 0.5rem;
      border-radius: var(--sl-border-radius, 0.5rem);
      color: var(--sl-color-gray-3);
      background: var(--sl-color-gray-6);
      transition:
        color 0.2s var(--sl-ease, ease),
        background 0.2s var(--sl-ease, ease),
        transform 0.2s var(--sl-ease, ease);
      text-decoration: none;
      position: relative;
    }

    .social-link:hover,
    .social-link:focus-visible {
      color: var(--sl-color-white);
      background: var(--sl-color-gray-5);
      transform: translateY(-2px);
    }

    .social-link:focus-visible {
      outline: 2px solid var(--sl-color-accent);
      outline-offset: 2px;
    }

    /* ===========================
       COPYRIGHT
       =========================== */

    .copyright {
      text-align: center;
      font-size: var(--sl-text-xs);
      color: var(--sl-color-gray-4);
      padding: var(--sl-nav-gap, 0.5rem) 0;
      line-height: var(--sl-line-height, 1.6);
    }

    .copyright p {
      margin: 0;
    }

    /* ===========================
       STARLIGHT CREDIT
       =========================== */

    .kudos {
      align-items: center;
      gap: 0.5em;
      margin: var(--sl-content-pad-y, 1.5rem) auto;
      font-size: var(--sl-text-xs);
      text-decoration: none;
      color: var(--sl-color-gray-3);
      transition:
        color 0.2s var(--sl-ease, ease),
        transform 0.2s var(--sl-ease, ease);
      padding: 0.5rem;
      border-radius: var(--sl-border-radius, 0.25rem);
    }

    .kudos:hover,
    .kudos:focus-visible {
      color: var(--sl-color-white);
      transform: scale(1.05);
    }

    .kudos:focus-visible {
      outline: 2px solid var(--sl-color-accent);
      outline-offset: 2px;
    }

    /* ===========================
       LAYOUT VARIATIONS
       =========================== */

    /* Centered layout - all content centered */
    .layout-centered {
      align-items: center;
      text-align: center;
    }

    .layout-centered .meta,
    .layout-centered .custom-links,
    .layout-centered .social-links {
      justify-content: center;
    }

    /* Multi-column layout - better for content-heavy footers */
    .layout-multi-column .footer-sections {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
  }

  @layer starlight.components {
    .kudos .starlight-icon {
      color: var(--sl-color-orange);
      font-size: 1.2em;
      display: inline-block;
    }
  }

  /* ===========================
     RESPONSIVE DESIGN
     Mobile-first approach with breakpoints
     =========================== */

  /* Mobile (< 768px) - Base styles above are mobile-first */

  /* Tablet (>= 768px) */
  @media (min-width: 48rem) {
    .footer-sections {
      grid-template-columns: repeat(2, 1fr);
    }

    .layout-multi-column .footer-sections {
      grid-template-columns: repeat(3, 1fr);
    }

    .social-links {
      gap: calc(var(--sl-nav-gap, 1rem) * 1.5);
    }

    .social-link {
      width: 3rem;
      height: 3rem;
    }
  }

  /* Desktop (>= 1024px) */
  @media (min-width: 64rem) {
    .footer-sections {
      grid-template-columns: repeat(3, 1fr);
    }

    .layout-multi-column .footer-sections {
      grid-template-columns: repeat(4, 1fr);
    }

    .meta {
      gap: var(--sl-nav-gap, 1rem) 4rem;
    }

    .custom-links {
      gap: var(--sl-nav-gap, 1.5rem) 3rem;
    }
  }

  /* Large Desktop (>= 1280px) */
  @media (min-width: 80rem) {
    .footer-sections {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  /* ===========================
     REDUCED MOTION
     Respect user preferences
     =========================== */

  @media (prefers-reduced-motion: reduce) {
    .footer-link,
    .social-link,
    .section-link,
    .kudos {
      transition: none;
    }

    .footer-link:hover,
    .social-link:hover,
    .section-link:hover,
    .kudos:hover {
      transform: none;
    }
  }

  /* ===========================
     GALAXY THEME COMPATIBILITY
     Transparent backgrounds and proper layering
     =========================== */

  @media (prefers-color-scheme: dark) {
    .custom-footer {
      background: transparent;
      backdrop-filter: blur(8px);
    }

    .social-link {
      background: rgba(var(--sl-color-gray-6-rgb, 0, 0, 0), 0.4);
    }

    .social-link:hover {
      background: rgba(var(--sl-color-gray-5-rgb, 0, 0, 0), 0.6);
    }
  }

  /* ===========================
     HIGH CONTRAST MODE
     Enhanced accessibility
     =========================== */

  @media (prefers-contrast: high) {
    .footer-link,
    .section-link,
    .social-link {
      outline: 1px solid currentColor;
    }

    .with-border {
      border-top-width: 2px;
    }
  }

  /* ===========================
     PRINT STYLES
     Clean footer for printing
     =========================== */

  @media print {
    .custom-footer {
      border-top: 1px solid #000;
      padding-top: 1rem;
    }

    .social-links,
    .kudos {
      display: none;
    }

    .footer-link,
    .section-link {
      color: #000;
      text-decoration: underline;
    }

    /* Show hidden text for print */
    .visually-hidden {
      position: static;
      width: auto;
      height: auto;
      clip: auto;
      white-space: normal;
    }
  }
</style>
